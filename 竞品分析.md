# 竞品分析：Web 端 Markdown 工具

## 介绍

Cherry Markdown Editor 是一款 Javascript Markdown 编辑器，具有开箱即用、轻量简洁、易于扩展等特点. 它可以运行在浏览器或服务端(NodeJs).

开箱即用
开发者可以使用非常简单的方式调用并实例化 Cherry Markdown 编辑器，实例化的编辑器默认支持大部分常用的 markdown 语法（如标题、目录、流程图、公式等）。

易于拓展
当 Cherry Markdown 编辑器支持的语法不满足开发者需求时，可以快速的进行二次开发或功能扩展。同时，CherryMarkdown 编辑器应该由纯 JavaScript 实现，不应该依赖 angular、vue、react 等框架技术，框架只提供容器环境即可。

## 竞品

Marked.js

- 简介：Marked.js 是一个用 JavaScript 编写的快速 Markdown 解析器和编译器。
- 官方文档：[Marked.js document](https://marked.js.org/)
- 源码库：[Marked.js](https://github.com/markedjs/marked)

## 语法能力

- cherry markdown:

  1. 图片缩放、对齐、引用
  2. 根据表格内容生成图表
  3. 字体颜色、字体大小
  4. 字体背景颜色、上标、下标
  5. checklist
  6. 音视频

- marked.js:

  1. CommonMark 语法（持续开发中）
  2. GitHub Flavored Markdown 语法（持续开发中）

> 相较于 marked.js，cherry markdown 对于 commonMark 和 GitHub Flavored Markdown 的语法开发更为完善，在显示上也更为美观，对于代码块的编写 cherry markdown 会提供工具栏来进行选择语言，方便用户进行快捷选择

## 功能

- cherry markdown:

  1. 复制 Html 粘贴成 MD 语法
  2. 经典换行&常规换行
  3. 多光标编辑
  4. 图片尺寸
  5. 导出长图、pdf
  6. float toolbar 在新行行首支持快速工具栏
  7. bubble toolbar 选中文字时联想出快速工具栏
  8. 实时渲染
  9. 代码块高亮
  10. 表格支持

- marked.js:

  1. 实时渲染
  2. 表格支持
  3. 复制 Html 粘贴成 MD 语法
  4. 经典换行&常规换行

> 两者相较来说，marked.js 更偏向轻量化一些，所拥有的功能都是一般的 markdown 具有的基础功能，开发的自由度更高，cherry markdown 所具有的功能更全面更高级，还为用户提供了便捷使用的工具栏，开发自由度相对来说低一些，但便捷性更高一些，代码高亮相对 marked.js 也更清晰

## 安全性

- cherry markdown:
  Cherry Markdown 有内置的安全 Hook，通过过滤白名单以及 DomPurify 进行扫描过滤.

- marked.js:
  没有明显的安全漏洞分析的 Hook，但有对正则表达式进行修改，写了匹配正则表达式和非匹配正则表达式来进行安全处理

> 二者相较于安全问题的处理不一样，前者更注重安全全面性，调用 hook 来保证正则表达式的正常使用，后者更注重的是轻量化开发，减少迭代开发的负担，但二者对于灾难性回溯（ReDoS）等问题都有进行处理，增加产品的安全性

## 性能

> 测试方法：输入同一段测试文本，分析 DLC 和 FCP 的时间，来对比 parse 和 render 的性能

- 测试文本：

  # Markdown 测试文本

  ## 标题

  这是一个段落文本示例。**这里是粗体**，_这里是斜体_。

  ### 列表

  #### 无序列表：

  - 项目 1
  - 项目 2
  - 项目 3

  #### 有序列表：

  1. 项目 A
  2. 项目 B
  3. 项目 C

  ### 链接和图片

  [点击这里跳转到谷歌](https://www.google.com)

  ![图片示例](https://via.placeholder.com/150)

  ### 代码块

  ```javascript
  function greet(name) {
    console.log("Hello, " + name + "!");
  }
  greet("World");
  ```

  ### 引用

  > 这是一个引用示例。引用文本可以跨多行。

  ### 表格

  | 姓名    | 年龄 | 城市 |
  | ------- | ---- | ---- |
  | Alice   | 25   | 北京 |
  | Bob     | 30   | 上海 |
  | Charlie | 28   | 广州 |

  ### 分割线

  ***

- 分析：

  1. parse：对于同一段测试文本，marked.js 的 DCL 时间是 885.87ms，而 cherry markdown 的 DCL 时间是 375.69ms，相比来说，cherry markdown 对于 markdown 文本转 html 的能力更加出色，即使在多出一个工具栏的前提下，cherry markdown 的解析性能依然是要优于 mark.js 的，这是由于 cherry markdown 内部有对于字符串的验证和各种钩子函数来对解析过程进行优化，避免了不必要的正则验证，大大优化的解析效率。

  2. render：对于这段测试文本，marked.js 的 FCP 时间是 904.49ms，而 cherry markdown 的 FCP 时间是 570.91ms，相较之下，减去解析文档的时间，marked.js 渲染的性能是高于 cherry markdown 的，一方面， marked.js 具有更简洁的页面，便于渲染，用更简单的形式展现了 markdown 文本的特点，另一方面，marked.js 的功能更加简单，渲染的组件是要少于 cherry markdown 的，这些都是使得 marked.js 渲染性能更高的原因，

## 扩展能力

相比较之下，marked.js 牺牲了一些用户便捷操作和 markdown 文本的渲染的视觉效果，但获得了更高的可扩展性，和 markdown 文本转 html 的效率，相对来说 cherry markdown 的可扩展性会低一些，但其可插拔的特性让可扩展性有所提升的同时，也提高了 markdown 转 html 的效率

## 用户体验

总的来说，cherry markdown 的可扩展性是要低于 marked.js 的，虽然 cherry markdown 的可插拔语法提高了产品的可扩展性，但其对于样式的固定也还是增加了二次开发难度。cherry markdown 的产品较 marked.js 来说要成熟的多，markdown 语法更全面，有自带的工具栏，这虽然导致 cherry markdown 的二次开发难度变高，但也使得 cherry markdown 拥有即开即用的特点，便于直接使用，同时通过各种 api 修改功能，是的组件更加便捷。
